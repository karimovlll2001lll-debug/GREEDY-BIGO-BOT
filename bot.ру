BOT.Ñ€Ñƒ
import os
import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters
from collections import Counter
from datetime import datetime

logging.basicConfig(level=logging.INFO)

# Ð¢Ð²Ð¾Ð¹ Ñ‚Ð¾ÐºÐµÐ½
BOT_TOKEN = "8555500858:AAEdilH3irbwlo2PXrIbNdUovaSeY4o9Brw"

SYMBOLS = [
    ("ðŸ… ÐŸÐžÐœÐ˜Ð”ÐžÐ ", "pomidor"), ("ðŸ¥¬ ÐšÐÐŸÐ£Ð¡Ð¢Ð", "kapusta"), 
    ("ðŸŒ½ ÐšÐ£ÐšÐ£Ð Ð£Ð—Ð", "kukuruza"), ("ðŸ¥• ÐœÐžÐ ÐšÐžÐ’ÐšÐ", "sabzi"),
    ("ðŸŒ­ Ð¥ÐžÐ¢-Ð”ÐžÐ“", "hotdog"), ("ðŸ¢ Ð¨ÐÐ¨Ð›Ð«Ðš", "shashlyk"),
    ("ðŸ— ÐÐšÐÐ ÐžÐ§ÐšÐ", "akarochka"), ("ðŸ¥© Ð“Ð£Ð¨Ð¢", "gusht"),
]

user_data = {}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    if user_id not in user_data:
        user_data[user_id] = []
    
    keyboard = []
    row = []
    for name, symbol in SYMBOLS:
        row.append(InlineKeyboardButton(name, callback_data=f"add_{symbol}"))
        if len(row) == 2:
            keyboard.append(row)
            row = []
    if row: keyboard.append(row)
    
    keyboard.extend([
        [InlineKeyboardButton("ðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ", callback_data="stats"),
         InlineKeyboardButton("ðŸ”® ÐŸÐ ÐžÐ“ÐÐžÐ—", callback_data="predict")],
        [InlineKeyboardButton("ðŸ’¡ ÐŸÐžÐœÐžÐ©Ð¬", callback_data="help"),
         InlineKeyboardButton("ðŸ”„ Ð¡Ð‘Ð ÐžÐ¡", callback_data="reset")]
    ])
    
    await update.message.reply_text(
        "ðŸŽ® GREEDY BIGO ANALYZER\n\n"
        "Ð¢Ð²Ð¾Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð² Ð¸Ð³Ñ€Ðµ GREEDY!\n"
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð²Ñ‹Ð¿Ð°Ð²ÑˆÐ¸Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»:",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user_id = query.from_user.id
    await query.answer()
    data = query.data
    
    if data.startswith("add_"):
        symbol = data.replace("add_", "")
        symbol_name = next(name for name, sym in SYMBOLS if sym == symbol)
        
        if user_id not in user_data:
            user_data[user_id] = []
        user_data[user_id].append(symbol)
        
        total = len(user_data[user_id])
        await query.edit_message_text(f"âœ… {symbol_name}\nðŸ“Š Ð’ÑÐµÐ³Ð¾ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹: {total}")
        
    elif data == "stats":
        history = user_data.get(user_id, [])
        if not history:
            await query.edit_message_text("ðŸ“Š ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐÐ°Ñ‡Ð½Ð¸ Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°Ñ‚ÑŒ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹!")
            return
            
        counts = Counter(history)
        total = len(history)
        stats_text = f"ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ({total} Ñ€Ð°ÑƒÐ½Ð´Ð¾Ð²):\n\n"
        for name, symbol in SYMBOLS:
            count = counts.get(symbol, 0)
            percent = (count/total)*100 if total else 0
            if count > 0:
                stats_text += f"{name}: {count} ({percent:.1f}%)\n"
                
        await query.edit_message_text(stats_text)
        
    elif data == "predict":
        history = user_data.get(user_id, [])
        if len(history) < 3:
            await query.edit_message_text("ðŸ”® ÐÑƒÐ¶Ð½Ð¾ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 3 Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð°")
            return
            
        counts = Counter(history)
        total = len(history)
        pred_text = "ðŸ”® ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ñ€Ð°ÑƒÐ½Ð´:\n\n"
        for (symbol, count) in counts.most_common(3):
            name = next(n for n,s in SYMBOLS if s==symbol)
            percent = (count/total)*100
            pred_text += f"{name}: {percent:.1f}%\n"
            
        current_hour = datetime.now().hour
        if 18 <= current_hour <= 23:
            pred_text += "\nðŸŒ™ Ð’ÐµÑ‡ÐµÑ€ - Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ ÑÐ¼ÐµÐ»Ñ‹Ñ… ÑÑ‚Ð°Ð²Ð¾Ðº!"
        elif 6 <= current_hour <= 12:
            pred_text += "\nâ˜€ï¸ Ð£Ñ‚Ñ€Ð¾ - Ð¸Ð³Ñ€Ð°Ð¹ Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾"
            
        await query.edit_message_text(pred_text)
        
    elif data == "help":
        await query.edit_message_text(
            "ðŸ’¡ ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°:\n\n"
            "1. ÐŸÐ¾ÑÐ»Ðµ ÐšÐÐ–Ð”ÐžÐ“Ðž Ñ€Ð°ÑƒÐ½Ð´Ð° GREEDY Ð½Ð°Ð¶Ð¸Ð¼Ð°Ð¹ Ð½Ð° Ð²Ñ‹Ð¿Ð°Ð²ÑˆÐ¸Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»\n"
            "2. ÐŸÐ¾ÑÐ»Ðµ 3+ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ 'ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð·'\n"
            "3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ 'Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ' Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°\n\n"
            "ðŸŽ¯ Ð¡Ð¾Ð²ÐµÑ‚Ñ‹ Ð¿Ð¾ GREEDY:\n"
            "â€¢ ÐœÑÑÐ¾ Ñ‡Ð°Ñ‰Ðµ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼\n"
            "â€¢ ÐžÐ²Ð¾Ñ‰Ð¸ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹ ÑƒÑ‚Ñ€Ð¾Ð¼\n"
            "â€¢ Ð¡Ð»ÐµÐ´Ð¸ Ð·Ð° ÑÐµÑ€Ð¸ÑÐ¼Ð¸ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
        )
        
    elif data == "reset":
        if user_id in user_data:
            user_data[user_id] = []
        await query.edit_message_text("ðŸ”„ Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ñ‹!")

def main():
    application = ApplicationBuilder().token(BOT_TOKEN).build()
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(button_handler))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, 
                                         lambda u,c: u.message.reply_text("ÐÐ°Ð¶Ð¼Ð¸ /start Ð´Ð»Ñ Ð¼ÐµÐ½ÑŽ")))
    
    print("ðŸš€ Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!")
    print("ðŸ”— ÐÐ°Ð¹Ð´Ð¸ Ð² Telegram: @GreedyBigOAnalyzerBot")
    application.run_polling()

if __name__ == "__main__":
    main()
